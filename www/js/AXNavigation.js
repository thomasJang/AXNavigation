var AXNavigation=function(){function a(a,b){var c=a;if(c)for(;function(){var a=!0;return b&&(a=b(c)),!a}();){if(!c.parentNode){c=!1;break}c=c.parentNode}return c}function b(){(function(){this.config={swipe:!0,animateTime:300,addon_back:{html:'<i class="icon-dp-back"></i>'},toolbar_previous_title_show:!1},this.isCordova=window.cordova?!0:!1}).apply(this,arguments);var b=this,g=this.config;this.position=0,this.active_content_main="",this.content_tree={},this.animating=!1,this.aside_opend=!1,this.toolbar_status="",this.set_config=function(a,b){return $.extend(this.config,a,!0),this.device_width=$(document.body).width(),this.ready_swipe(),this},this.open_header=function(c,d,e,h,i){var j;if(g.tool_bar.find("#axn-navigation-"+c.objectName).get(0))j=g.tool_bar.find("#axn-navigation-"+c.objectName);else{var k=[];if(k.push('<div class="bar-wrapper" id="axn-navigation-'+c.objectName+'">'),c.header.title&&k.push('<div class="bar-title">'+c.header.title+"</div>"),"_right"==d&&(k.push('<a class="bar-addon left" data-header-btn="back">'+g.addon_back.html),g.toolbar_previous_title_show&&k.push('<span class="label">'+i.form.header.title+"</span>"),k.push("</a>")),c.header.addon)for(var l,m=0,n=c.header.addon.length;n>m;m++)l=c.header.addon[m],k.push('<a class="bar-addon '+l.type+'" data-header-btn="'+m+'">'+l.html+"</a>");k.push('<div style="clear: both;"></div>'),k.push("</div>"),g.tool_bar.append(k.join("")),j=g.tool_bar.find("#axn-navigation-"+c.objectName),h.header_jdom=j,h.header_jdom.find("[data-header-btn]").bind(f,function(d){var e=a(d.target,function(a){return null!=a.getAttribute("data-header-btn")});if(e&&!b.aside_opend){var f=e.getAttribute("data-header-btn");if("back"==f){var h={form:c};g.addon_back.onclick?g.addon_back.onclick.call(h,h):b.close(c)}else if(c.header.addon[f].onclick){var h={form:c,item:c.header.addon[f]};c.header.addon[f].onclick.call(h,h)}return!1}})}j.attr("class","bar-wrapper"),"_main"==d?j.addClass("fade-in"):"_right"==d?j.addClass("slide-in-right"):"fade"==e?j.addClass("fade-in"):j.addClass("slide-in-"+e),i&&(i.header_jdom.attr("class","bar-wrapper"),"fade"==e?i.header_jdom.addClass("fade-out"):i.header_jdom.addClass("slide-out-"+(e||"left")))},this.check_tool_tab_bar=function(a){if("undefined"!=typeof a.toolBar)if(a.toolBar){if(g.tool_bar.addClass("show"),"slide-up"==this.toolbar_status&&(g.tool_bar.removeClass("slide-out-up").addClass("slide-in-down"),this.toolbar_status=""),g.on_event){var b={action:"show_toolBar",form:a};g.on_event.call(b,b)}}else if(g.tool_bar.removeClass("show"),g.on_event){var b={action:"unshow_toolBar",form:a};g.on_event.call(b,b)}"undefined"!=typeof a.tabBar&&(a.tabBar?g.tab_bar.addClass("show"):g.tab_bar.removeClass("show"))},this.slide_up_toolbar=function(){this.toolbar_up_timer&&clearTimeout(this.toolbar_up_timer),this.toolbar_down_timer&&clearTimeout(this.toolbar_down_timer),"slide-up"!=this.toolbar_status&&(this.toolbar_up_timer=setTimeout(function(){g.tool_bar.removeClass("slide-in-down").addClass("slide-out-up")},g.animateTime),this.toolbar_status="slide-up")},this.slide_down_toolbar=function(){this.toolbar_up_timer&&clearTimeout(this.toolbar_up_timer),this.toolbar_down_timer&&clearTimeout(this.toolbar_down_timer),"slide-down"!=this.toolbar_status&&(g.tool_bar.removeClass("slide-out-up").addClass("slide-in-down"),this.toolbar_status="slide-down")},this.open=function(a,b,c,d){if(this.animating)return this;if(this.aside_opend)return this;var e,f,h;if("_main"==b&&this.active_content_main==a.objectName)return this;if("_right"==b&&(e=this.content_tree[this.active_content_main][this.content_tree[this.active_content_main].length-1],e.objectName==a.objectName))return this;this.check_tool_tab_bar(a),this.animating=!0;var i,j,k=!1;if(""==this.active_content_main&&"_main"!=b&&(b="_main"),"_main"==b?(""!=this.active_content_main&&this.content_tree[this.active_content_main].length>0&&(e=this.content_tree[this.active_content_main][this.content_tree[this.active_content_main].length-1],f="",f="fade"==c?"fade-out":"slide-out-"+(c||"left"),e.jdom.attr("class",g.content_wrapper_class_name+function(){return e.form.className?" "+e.form.className:""}()),e.jdom.addClass(f),e.header_jdom&&e.header_jdom.addClass(f),k=!0),"undefined"==typeof this.content_tree[a.objectName]?(i='<div class="'+g.content_wrapper_class_name+" "+(a.className||"")+'" id="axn-content-'+a.objectName+'" data-content-target="'+b+'"></div>',g.content_container.prepend(i),j=g.content_container.find("#axn-content-"+a.objectName),h={form:a,jdom:j},a.header&&this.open_header(a,b,c,h,e),$.get(a.url,function(b){j.addClass("fade-in"),j.append(b),window[a.objectName]&&setTimeout(function(){window[a.objectName][a.startFunction]()},1)}),j.bind("scroll",function(b){if(g.on_scroll){var c={form:a,scroll_top:b.target.scrollTop};g.on_scroll.call(c,c)}})):(h=this.content_tree[a.objectName][0],h.jdom.attr("class",g.content_wrapper_class_name+function(){return a.className?" "+a.className:""}()),k&&h.jdom.addClass("fade-in"),a.header&&this.open_header(a,b,c,h,e),window[a.objectName]&&window[a.objectName].active&&(window[a.objectName].active(),setTimeout(function(){$(window).resize()},1)))):"_right"==b&&(i='<div class="'+g.content_wrapper_class_name+" "+(a.className||"")+'" id="axn-content-'+a.objectName+'" data-content-target="'+b+'" style="display:none;"></div>',g.content_container.append(i),j=g.content_container.find("#axn-content-"+a.objectName),h={form:a,jdom:j,param:d},e=this.content_tree[this.active_content_main][this.content_tree[this.active_content_main].length-1],e.jdom.attr("class",g.content_wrapper_class_name+function(){return e.form.className?" "+e.form.className:""}()),a.header&&this.open_header(a,b,"fade",h,e),$.get(a.url,function(b){j.show().addClass("slide-in-right"),j.append(b),window[a.objectName]&&setTimeout(function(){window[a.objectName][a.startFunction](d)},1)})),setTimeout(function(){if(this.animating=!1,"_main"==b){var c=this.content_tree[this.active_content_main];if(c&&c[0]){c[0].jdom.removeClass("fade-in");for(var d=1,e=c.length;e>d;d++)c[d].jdom.remove(),c[d].header_jdom&&c[d].header_jdom.remove(),window[c[d].form.objectName]&&delete window[c[d].form.objectName]}this.content_tree[a.objectName]=[h],this.active_content_main=a.objectName}else"_right"==b&&(h.jdom.removeClass("slide-in-right"),this.content_tree[this.active_content_main].push(h))}.bind(this),g.animateTime),g.on_event){var l={action:"open",form:a};g.on_event.call(l,l)}},this.close=function(){if(this.animating)return this;if(""==this.active_content_main)return this;this.animating=!0;var a=this.content_tree[this.active_content_main],b=a[a.length-2].form;this.check_tool_tab_bar(b),a[a.length-2].jdom.removeClass("slide-out-left"),a[a.length-1].jdom.removeClass("slide-in-right").addClass("slide-out-right"),b.header&&(a[a.length-2].header_jdom.removeClass("fade-out"),a[a.length-1].header_jdom.removeClass("slide-in-right").addClass("slide-out-right")),setTimeout(function(){a[a.length-2].jdom.removeClass("slide-in-left"),a[a.length-1].jdom.remove(),b.header&&(a[a.length-2].header_jdom.removeClass("slide-in-left"),a[a.length-1].header_jdom.remove()),window[a[a.length-1].objectName]&&delete window[a[a.length-1].objectName],a.pop(),this.animating=!1}.bind(this),g.animateTime)},this.remove_tree=function(a){for(var b=0,c=a.length;c>b;b++){var d=this.content_tree[a[b]];if(d)for(var e=0,f=d.length;f>e;e++)d[e].jdom.remove(),d[e].header_jdom&&d[e].header_jdom.remove(),window[d[e].form.objectName]&&delete window[d[e].form.objectName]}},this.scroll_top=function(a){if(this.animating)return this;if(""==this.active_content_main)return this;b.animating=!0;var c=this.content_tree[this.active_content_main],d=c[c.length-1].jdom;d.css({"-webkit-overflow-scrolling":"none",overflow:"hidden"}),d.stop().animate({scrollTop:a},g.animateTime,"swing",function(){b.animating=!1,d.css({"-webkit-overflow-scrolling":"touch",overflow:"auto"})})},this.open_aside=function(a){if(this.aside_opend=!0,this.app_mask=$('<div class="app-content-mask"></div>'),"aside_left"==a?(g.aside_left.show(),g.tool_bar.addClass("open-aside-left"),g.content_container.addClass("open-aside-left"),$(document.body).append(this.app_mask),this.app_mask.addClass("open-aside-left"),this.app_mask.bind(f,function(a){return b.close_aside("aside_left"),a.preventDefault(),a.stopPropagation(),!1})):"aside_right"==a&&(g.aside_right.show(),g.tool_bar.addClass("open-aside-right"),g.content_container.addClass("open-aside-right"),$(document.body).append(this.app_mask),this.app_mask.addClass("open-aside-right"),this.app_mask.bind(f,function(a){return b.close_aside("aside_right"),a.preventDefault(),a.stopPropagation(),!1})),g.tab_bar.addClass("slide-out-down"),g.on_event){var c={action:"open_aside",type:a};g.on_event.call(c,c)}},this.close_aside=function(a){if(g.tool_bar.removeClass("open-aside-left").removeClass("open-aside-right"),g.content_container.removeClass("open-aside-left").removeClass("open-aside-right"),"aside_left"==a?(g.tool_bar.addClass("close-aside-left"),g.content_container.addClass("close-aside-left"),this.app_mask.removeClass("open-aside-left").addClass("close-aside-left")):"aside_right"==a&&(g.tool_bar.addClass("close-aside-right"),g.content_container.addClass("close-aside-right"),this.app_mask.removeClass("open-aside-right").addClass("close-aside-right")),g.tab_bar.removeClass("slide-out-down").addClass("slide-in-up"),setTimeout(function(){g.aside_left.hide(),g.aside_right.hide(),this.app_mask.remove(),g.tool_bar.removeClass("close-aside-left").removeClass("close-aside-right"),g.content_container.removeClass("close-aside-left").removeClass("close-aside-right"),g.tab_bar.removeClass("slide-in-up"),this.aside_opend=!1}.bind(this),g.animateTime),g.on_event){var b={action:"close_aside",type:a};g.on_event.call(b,b)}},this.reload=function(){if(""==this.active_content_main)return this;var a=this.content_tree[this.active_content_main],b=a.length-1,c=a[b].form,d=a[b].param;window[a[b].form.objectName]&&delete window[a[b].form.objectName],jdom=g.content_container.find("#axn-content-"+c.objectName),jdom.empty(),$.get(c.url,function(a){jdom.append(a),window[c.objectName]&&window[c.objectName][c.startFunction](d)})},this.get_mouse=function(a){var b={};return"originalEvent"in a&&(a=a.originalEvent),"changedTouches"in a?(b.x=Number(a.changedTouches[0].pageX),b.y=Number(a.changedTouches[0].pageY)):"touches"in a&&a.touches[0]?(b.x=Number(a.touches[0].pageX),b.y=Number(a.touches[0].pageY)):(b.x=Number(a.pageX),b.y=Number(a.pageY)),b},this.ready_swipe=function(){if(g.swipe){var a={},f={};this.swipe_fn={touch_start:function(c){var f=this,g=b.content_tree[b.active_content_main];return g.length<2?!1:(a={mouse:b.get_mouse(c),time:(new Date).getTime(),move_content:g[g.length-1].jdom,position:g[g.length-1].jdom.position()},a.move_content.removeClass("touch-end"),$(document.body).bind(d+".axnavigation",function(a){f.touch_move(a||window.event)}),$(document.body).bind(e+".axnavigation",function(a){f.touch_end(a||window.event)}),void $(document.body).attr("onselectstart","return false;"))},touch_move:function(c){var f=b.get_mouse(c);if(!a.direction){var g=Math.abs(a.mouse.x-f.x),h=2*Math.abs(a.mouse.y-f.y);g>2&&(a.direction=g>h?"X":"Y")}if("X"==a.direction){var i=Number(a.position.left)-(a.mouse.x-f.x);if(0>i)return $(document.body).unbind(d+".axnavigation"),$(document.body).unbind(e+".axnavigation"),$(document.body).removeAttr("onselectstart"),c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation(),c.cancelBubble=!0,!1;a.move_content.css({left:i}),a.time=(new Date).getTime(),a.new_left=i,c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation(),c.cancelBubble=!0}else $(document.body).unbind(d+".axnavigation"),$(document.body).unbind(e+".axnavigation"),$(document.body).removeAttr("onselectstart")},touch_end:function(c){f={mouse:b.get_mouse(c),time:(new Date).getTime()};var g=f.time-a.time,h=a.new_left;"X"==a.direction&&(120>g&&Math.abs(a.mouse.x-f.mouse.x)>5?b.close():h>100?b.close():a.move_content.css({left:0}).addClass("touch-end"),c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation(),c.cancelBubble=!0),$(document.body).unbind(d+".axnavigation"),$(document.body).unbind(e+".axnavigation"),$(document.body).removeAttr("onselectstart")}},g.content_container.on(c,function(a){b.swipe_fn.touch_start(a||window.event)})}}}var c,d,e,f="click";return"ontouchstart"in document.documentElement?(c="touchstart",d="touchmove",e="touchend"):(c="mousedown",d="mousemove",e="mouseup"),b}();