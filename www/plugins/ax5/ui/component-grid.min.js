!function(root,ax_super){var U=ax5.util,axd=ax5.dom,ax_class=function(){this.main=function(){ax_super&&ax_super.call(this),this.config={click_event_name:"ontouchstart"in document.documentElement?"touchstart":"click",theme:"default"}}.apply(this,arguments),this.list=[],this.page={},this.target=null,this.selected_item=null;var cfg=this.config;this.init=function(){cfg.target||U.error("aui_component_grid_400","[ax5.ui.component_grid] config.target is required"),this.target=ax5.dom(cfg.target),this.target.html(this.get_frame()),this.els={root:this.target.find('[data-component-grid-els="root"]'),body:this.target.find('[data-component-grid-els="body"]'),control:this.target.find('[data-component-grid-els="control"]')},this.target.find("[data-component-grid-item-index]").on(cfg.click_event_name,function(e){this.onclick(e||window.event)}.bind(this)),this.target.find("[data-component-grid-control]").on(cfg.click_event_name,function(e){this.onmove(e||window.event)}.bind(this)),this.set_size_frame(),this.bind_window_resize(function(){this.set_size_frame()})},this.resize=function(){this.set_size_frame()},this.get_frame=function(){var po=[],i=0;po.push('<div class="ax5-ui-component-grid '+cfg.theme+'" data-component-grid-els="root">'),po.push('<div class="component-grid-body" data-component-grid-els="body">'),po.push('<table cellpadding="0" cellspacing="0">'),po.push("<tbody>");for(var r=0;r<cfg.rows;r++){po.push("<tr>");for(var c=0;c<cfg.cols;c++)po.push("<td>"),po.push('<div class="ax-item-wraper '+(cfg.item.addon?"has-addon":"")+'">'),po.push('<button class="ax-btn '+(cfg.item.klass||"")+'" data-component-grid-item-index="'+i+'"></button>'),po.push("</div>"),po.push("</td>"),i++;po.push("</tr>")}return po.push("</tbody>"),po.push("</table>"),po.push("</div>"),cfg.control&&(po.push('<div class="component-grid-control" data-component-grid-els="control" style="width:'+cfg.control.width+'px;">'),po.push('<table cellpadding="0" cellspacing="0">'),po.push("<tbody>"),po.push("<tr>"),po.push("<td>"),po.push('<div class="ax-item-wraper">'),po.push('<button class="ax-btn '+(cfg.item.klass||"")+'" data-component-grid-control="prev">'+cfg.control.prev+"</buttton>"),po.push("</div>"),po.push("</td>"),po.push("</tr>"),po.push("<tr>"),po.push("<td>"),po.push('<div class="ax-item-wraper">'),po.push('<button class="ax-btn '+(cfg.item.klass||"")+'" data-component-grid-control="next">'+cfg.control.next+"</button>"),po.push("</div>"),po.push("</td>"),po.push("</tr>"),po.push("</tbody>"),po.push("</table>"),po.push("</div>")),po.push("</div>"),po.join("")},this.set_size_frame=function(){var target_height=this.target.height();this.els.body.find(".ax-item-wraper").css({height:target_height/cfg.rows}),this.els.control.find(".ax-item-wraper").css({height:target_height/2})},this.onclick=function(e,target,index){target=axd.parent(e.target,function(target){return ax5.dom.attr(target,"data-component-grid-item-index")?!0:void 0}),target&&(this.selected_item&&axd.class_name(this.selected_item,"remove","selected"),this.selected_item=target,this.selected_item_pgno=this.page.no,axd.class_name(target,"add","selected"),index=axd.attr(target,"data-component-grid-item-index"),this.config.onclick&&this.config.onclick.call({index:index,list:this.list,item:this.list[U.number(index)+this.page.no*this.page.size],target:this.target.elements[0],item_target:target}))},this.onmove=function(e,target,dirc){target=axd.parent(e.target,function(target){return ax5.dom.attr(target,"data-component-grid-control")?!0:void 0}),target&&(dirc=axd.attr(target,"data-component-grid-control"),"prev"==dirc?this.page.no<1||(this.page.no--,this.print_list()):this.page.no<this.page.count-1&&(this.page.no++,this.print_list()))},this.set_list=function(list){this.list=list,this.page.no=0,this.page.size=cfg.rows*cfg.cols,this.page.count=Math.ceil(this.list.length/this.page.size),this.print_list()},this.print_list=function(){function formatter(val,format){if(U.is_function(format)){var that={value:val};return format.call(that)}return"money"==format?U.number(val,{money:!0}):val}this.selected_item&&(axd.class_name(this.selected_item,"remove","selected"),this.selected_item_pgno==this.page.no&&axd.class_name(this.selected_item,"add","selected"));for(var item_index=this.page.no*this.page.size,i=0;i<this.page.size;i++){var node=this.els.body.find('[data-component-grid-item-index="'+i+'"]'),item=this.list[item_index];item?(node.html('<div class="label">'+formatter(item[cfg.item.label.key],cfg.item.label.formatter)+"</div>"),cfg.item.addon&&node.append('<div class="addon">'+formatter(item[cfg.item.addon.key],cfg.item.addon.formatter)+"</div>")):node.empty(),item_index++}},this.click=function(index){if(this.list[U.number(index)+this.page.no*this.page.size]){var target=this.target.find('[data-component-grid-item-index="'+index+'"]');this.selected_item&&axd.class_name(this.selected_item,"remove","selected"),this.selected_item=target,this.selected_item_pgno=this.page.no,axd.class_name(target,"add","selected"),this.config.onclick&&this.config.onclick.call({index:index,list:this.list,item:this.list[U.number(index)+this.page.no*this.page.size],target:this.target.elements[0],item_target:target})}return this}};U.is_function(ax_super)&&(ax_class.prototype=new ax_super),root.component_grid=ax_class,"function"==typeof define&&define.amd&&define("_ax5_ui_component_grid",[],function(){return ax_class})}(ax5.ui,ax5.ui.root);