!function(root,ax_super){var U=ax5.util,axd=ax5.dom,ax_class=function(){this.main=function(){ax_super&&ax_super.call(this),this.config={click_event_name:"click",mask:{target:document.body,content:""},theme:"default",width:300,height:400,title:"",heading:{height:30},esc_close:!0}}.apply(this,arguments),this.active_modal=null,this.els={},this.mask=new ax5.ui.mask;var cfg=this.config;this.init=function(){cfg.id="ax5-modal-"+ax5.get_guid(),this.mask.set_config(cfg.mask)},this.get_content=function(modal_id,opts){var po=[];if(po.push('<div id="'+modal_id+'" data-modal-els="root" class="ax5-ui-modal '+opts.theme+'">'),po.push('<div class="ax-modal-heading" data-modal-els="heading" style="height:'+cfg.heading.height+"px;line-height:"+cfg.heading.height+'px;">'),po.push(opts.title||cfg.title||""),po.push("</div>"),po.push('<div class="ax-modal-body" data-modal-els="body">'),opts.http){po.push('<iframe name="'+modal_id+'-frame" src="" width="100%" height="100%" frameborder="0" data-modal-els="iframe"></iframe>'),po.push('<form name="'+modal_id+'-form" data-modal-els="iframe-form">'),po.push('<input type="hidden" name="modal_id" value="'+modal_id+'" />');for(var p in opts.http.param)po.push('<input type="hidden" name="'+p+'" value="'+opts.http.param[p]+'" />');po.push("</form>")}return po.push("</div>"),po.push("</div>"),po.join("")},this.open=function(opts){var box={};if(opts.id=opts.id||cfg.id,this.mask.open(),box={width:opts.width||cfg.width,height:opts.height||cfg.height},axd.append(document.body,this.get_content(opts.id,opts)),this.active_modal=ax5.dom("#"+opts.id),this.els={root:this.active_modal.find('[data-modal-els="root"]'),heading:this.active_modal.find('[data-modal-els="heading"]'),body:this.active_modal.find('[data-modal-els="body"]')},opts.http&&(this.els.iframe=this.active_modal.find('[data-modal-els="iframe"]'),this.els["iframe-form"]=this.active_modal.find('[data-modal-els="iframe-form"]')),"undefined"==typeof opts.position||"center"===opts.position?(box.top=ax5.dom.height(document.body)/2-box.height/2,box.left=ax5.dom.width(document.body)/2-box.width/2):(box.left=opts.position.left||0,box.top=opts.position.top||0),this.active_modal.css(box),opts.http)this.els.iframe.css({height:box.height-cfg.heading.height}),this.els["iframe-form"].attr({method:opts.http.method}),this.els["iframe-form"].attr({target:opts.id+"-frame"}),this.els["iframe-form"].attr({action:opts.http.url}),this.els.iframe.on("load",function(){opts.onload?opts.onload.call(opts):cfg.onload&&cfg.onload.call(opts)}.bind(this)),this.els["iframe-form"].elements[0].submit();else{var that={id:opts.id,theme:opts.theme,width:opts.width,height:opts.height};U.extend(that,this.els),opts.onload?opts.onload.call(that):cfg.onload&&cfg.onload.call(that)}cfg.esc_close&&axd(window).on("keydown.ax-modal",function(e){this.onkeyup(e||window.event,opts)}.bind(this))},this.onkeyup=function(e,opts){e.keyCode==ax5.info.event_keys.ESC&&(this.close(),opts.onclose?opts.onclose.call(opts):cfg.onclose&&cfg.onclose.call(opts))},this.close=function(){return this.active_modal&&(this.active_modal.remove(),this.mask.close(),this.active_modal=null,axd(window).off("keydown.ax-modal")),this}};U.is_function(ax_super)&&(ax_class.prototype=new ax_super),root.modal=ax_class,"function"==typeof define&&define.amd&&define("_ax5_ui_modal",[],function(){return ax_class})}(ax5.ui,ax5.ui.root);